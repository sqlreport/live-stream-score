<!DOCTYPE html>
<html>
  <head>
    <title>Score</title>
    <style>
      .scoreboard {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        max-height: 100px;
        overflow: auto;
      }
      .teams {
        display: flex;
        justify-content: space-between;
        width: 50%;
        font-size: 36px;
      }
      .team {
        background: linear-gradient(to right, silver, lightgray);
        display: flex;
        flex-direction: row;
        align-items: center;
      }

      .score {
        font-size: 36px;
        font-weight: bold;
        margin-bottom: 20px;
      }

      .period {
        font-size: 16px;
        font-weight: bold;
      }

      .time {
        font-size: 16px;
        font-weight: bold;
      }
      
      .time-period {
        display: flex;
        justify-content: space-between;
        padding: 20px;
        font-size: 20px;
        margin-top: 20px;
      }
    </style>
<script>
  let stopwatchInterval;
  let endTime;
  let remainingTimeWhenStopped;
  let remaining_time
  let period
  let status
  
  async function getRemainingTime(game_id) {
        
        const response = await fetch(`/match/${game_id}/time`);
        const data = await response.json();

        result = { game_id: game_id, status: data.status, period: data.period, remaining_time: data.remaining_time };
        console.log("result:");
        console.log(result);
    
        remaining_time = data.remaining_time;
        period = data.period;
        status = data.status;
        
      }
  
  function displayRemainingTime() {
    
    let game_id = "{{ game_id }}";
    
    //let remainingTime=localStorage.getItem("remainingTimeWhenStopped");
    let homeTeam = localStorage.getItem("homeTeam");
    let guestTeam = localStorage.getItem("guestTeam");
    //let period = localStorage.getItem("period");
    
    document.getElementById("home-team").innerHTML = homeTeam;
    document.getElementById("guest-team").innerHTML = guestTeam;
    
    endTime = Date.now();
    parentInterval = setInterval(function() {
      getRemainingTime(game_id);
          
      endTime = remaining_time
      console.log("endTime:");
      console.log(endTime);
      
      document.getElementById("period").innerHTML = period;
      
      if (status==="start") {
        stopwatchInterval = setInterval(function() {
          let remainingTime = endTime - Date.now();
          console.log("remainingTime:");
          console.log(remainingTime);
          
          if (remainingTime <= 0) {
            clearInterval(stopwatchInterval);
            document.getElementById("stopwatch").innerHTML = "Time's up!";
            return;
          }
          let minutes = Math.floor(remainingTime / 60000);
          let seconds = Math.floor((remainingTime % 60000) / 1000);
          let milliseconds = Math.floor(remainingTime % 1000 / 100);
          if (minutes === 0) {
            document.getElementById("stopwatch").innerHTML =
              seconds + "." + milliseconds;
          } else {
            document.getElementById("stopwatch").innerHTML =
              minutes + ":" + seconds.toString().padStart(2, "0");
          }
          localStorage.setItem("remainingTimeWhenStopped", remainingTime);
          
        }, 1000);
      } else if (status==="stop" || status==="reset") {
          console.log(status);
        
          remainingTime=remaining_time;
          let minutes = Math.floor(remainingTime / 60000);
          let seconds = Math.floor((remainingTime % 60000) / 1000);
          let milliseconds = Math.floor(remainingTime % 1000 / 100);
          if (minutes === 0) {
            document.getElementById("stopwatch").innerHTML =
              seconds + "." + milliseconds;
          } else {
            document.getElementById("stopwatch").innerHTML =
              minutes + ":" + seconds.toString().padStart(2, "0");
          }
          localStorage.setItem("remainingTimeWhenStopped", remainingTime);
      }
    }, 3000);
  }
</script>
  </head>
  <body onload="displayRemainingTime()">
     <div class="scoreboard">
      <div class="teams">
        <div class="team">
          <div id="home-logo" class="team-logo"><img src="/static/morges.png"  width="40" height="40" ></div>
          <div id="home-team" class="team">Home</div>
          <div id="home-score" class="score">0</div>
        </div>
        <div class="time-period">
          <div class="time" id="stopwatch">0:00</div>
          <div class="period" id="period"></div>
        </div>
        <div class="team">
          <div id="guest-score" class="score">0</div>
          <div id="guest-team" class="team-name">Guest</div>
          <div id="home-logo" class="team-logo"><img src="/static/ajoie.png"  width="40" height="40" ></div>
        </div>
      </div>
    </div> 
  </body>
</html>
